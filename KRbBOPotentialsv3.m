function U=KRbBOPotentialsv3(r,sel)
% Energies in cm^-1, lengths in angstroms

if sel==0,
    %% Singlet potential
    Rinner=3;
    Router=11;

    %% Inner region
    A=-0.731001924e4;
    B=0.590300435e6;

    %% Intermediate region
    b=-0.39;
    Rm=4.06818602;
    a(1)=-4217.814754;
    a(2)=5.5301658603466688;
    a(3)=14026.909404099499;
    a(4)=10483.184351774529;
    a(5)=-4087.9718980305802;
    a(6)=-18176.598805414629;
    a(7)=-27398.890531547961;
    a(8)=-39307.30951201573;
    a(9)=175501.31928624859;
    a(10)=436686.71523402602;
    a(11)=-6031147.9482067721;
    a(12)=-7948028.2013661051;
    a(13)=117229324.7025888;
    a(14)=92094552.565567106;
    a(15)=-1533597323.7416561;
    a(16)=-698252618.25856519;
    a(17)=14182071400.355358;
    a(18)=3514113318.7929816;
    a(19)=-95296254355.53511;
    a(20)=-10967586194.002161;
    a(21)=474382656941.39032;
    a(22)=14771395219.527262;
    a(23)=-1768149926253.1221;
    a(24)=34966656697.789436;
    a(25)=4947896972615.874;
    a(26)=-237350654065.6795;
    a(27)=-10339133495099.701;
    a(28)=623484317008.03333;
    a(29)=15886268578340.809;
    a(30)=-974057479590.67065;
    a(31)=-17418611564347.012;
    a(32)=941030669909.20361;
    a(33)=12896143543868.871;
    a(34)=-522098648534.66638;
    a(35)=-5776754651606.4189;
    a(36)=127843143741.8345;
    a(37)=1182411100178.1711;
    
    %% Outer Region
    Uinf=0;
    C6=0.2072097e8;
    C8=0.6509487e9;
    C10=0.2575245e11;
    Aex=-0.1469387e5;
    Gamma=5.25669;
    Beta=2.11445;
    
else
    %% Triplet potential
    Rinner=4.956;
    Router=11;

    %% Inner region
    A=-0.102755858e4;
    B=0.595720017e6;

    %% Intermediate region
    b=-0.41;
    Rm=5.9021;
    a(1)=-249.03046699999999;
    a(2)=-0.82495705328529356;
    a(3)=1696.3616829079169;
    a(4)=2195.6185539363878;
    a(5)=-18303.31320330776;
    a(6)=-357761.02465674467;
    a(7)=760594.31795920501;
    a(8)=23219482.113546878;
    a(9)=-29691083.590665229;
    a(10)=-906695846.54307342;
    a(11)=1193993210.361681;
    a(12)=22712991346.526051;
    a(13)=-38221958779.879272;
    a(14)=-373366344820.94574;
    a(15)=825888146552.24622;
    a(16)=3983625994810.5288;
    a(17)=-11701349523226.789;
    a(18)=-25729218140497.613;
    a(19)=108317260197321.89;
    a(20)=73169446028069.141;
    a(21)=-640130432139345.5;
    a(22)=209067446138309;
    a(23)=2236346785424132;
    a(24)=-2555345293959939;
    a(25)=-3556041967731776;
    a(26)=8321268009266810;
    a(27)=-1364612053210692;
    a(28)=-9030566262973000;
    a(29)=8950177388640356;
    a(30)=-2723988913077922;
    
    %% Outer Region
    Uinf=0;
    C6=0.2072097e8;
    C8=0.6509487e9;
    C10=0.2575245e11;
    Aex=0.1469387e5;
    Gamma=5.25669;
    Beta=2.11445;
end;

Uinner=A+B./r.^4;
x=(r-Rm)./(r+b.*Rm);
Nterms=numel(a);
Uir=zeros(size(r));
for nn=1:Nterms,
    Uir=Uir+a(nn).*x.^(nn-1);
end;
rtmp=r(:);
rtmp=rtmp(rtmp>=Router);

FF=1;

[f6_Rb,f8_Rb,f10_Rb]=RbRetardation(rtmp*FF);
[f6a,f8a,f10a]=RbRetardation(Router*FF);
f6_Rb=f6_Rb./f6a;
f8_Rb=f8_Rb./f8a;
f10_Rb=f10_Rb./f10a;

[f6_K,f8_K,f10_K]=KRetardation(rtmp*FF);
[f6a,f8a,f10a]=KRetardation(Router*FF);
f6_K=f6_K./f6a;
f8_K=f8_K./f8a;
f10_K=f10_K./f10a;

f6=0.5*(f6_Rb+f6_K);
f8=0.5*(f8_Rb+f8_K);
f10=0.5*(f10_Rb+f10_K);


%f6=(f6-1)/FF+1;
%f8=(f8-1)/FF+1;
%f10=(f10-1)/FF+1;
f6=reshape([ones(numel(r)-numel(rtmp),1);f6],size(r));
f8=reshape([ones(numel(r)-numel(rtmp),1);f8],size(r));
f10=reshape([ones(numel(r)-numel(rtmp),1);f10],size(r));

%CP=KRbCP_Potential(rtmp);
%CP=reshape([zeros(numel(r)-numel(rtmp),1);CP],size(r));
%Uouter=Uinf+CP+Aex.*r.^Gamma.*exp(-Beta.*r);
Uouter=Uinf-f6.*C6./r.^6-f8.*C8./r.^8-f10.*C10./r.^10+Aex.*r.^Gamma.*exp(-Beta.*r);
% Uouter=Uinf-C6./r.^6-C8./r.^8-C10./r.^10+Aex.*r.^Gamma.*exp(-Beta.*r);
U=Uinner.*(r<Rinner) + Uir.*((r>=Rinner) & (r<=Router)) + Uouter.*(r>Router);

end

